(this.webpackJsonpkalina_paint=this.webpackJsonpkalina_paint||[]).push([[0],{26:function(t,e,i){},59:function(t,e,i){},67:function(t,e,i){},68:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),s=i(16),o=i.n(s),c=i(17),r=i(6),l=i(7),h=i(4),u=new(function(){function t(){Object(r.a)(this,t),this.tool=null,this.strokeStyle="#000000",Object(h.d)(this)}return Object(l.a)(t,[{key:"setTool",value:function(t){this.tool=t}},{key:"setFillColor",value:function(t){this.tool.fillColor=t}},{key:"setStrokeColor",value:function(t){this.strokeStyle=t,this.tool.strokeStyle=this.strokeStyle}},{key:"setLineWidth",value:function(t){this.tool.lineWidth=t}}]),t}()),d=(i(26),i(1)),f=Object(c.a)((function(){return Object(d.jsxs)("div",{className:"toolbar settingbar",children:[Object(d.jsx)("label",{htmlFor:"line-width",children:"Line width"}),Object(d.jsx)("input",{type:"number",id:"line-width",style:{margin:"0 15px 0 5px"},defaultValue:1,min:1,max:50,onChange:function(t){return u.setLineWidth(t.target.value)}}),Object(d.jsx)("label",{htmlFor:"stroke-color",children:"Stroke color"}),Object(d.jsx)("input",{type:"color",id:"stroke-color",style:{margin:"0 15px 0 5px"},onChange:function(t){return u.setStrokeColor(t.target.value)},value:u.strokeStyle})]})})),v=i(18),g=new(function(){function t(){Object(r.a)(this,t),this.canvas=null,this.socket=null,this.sessionid=null,this.undoList=[],this.redoList=[],this.username="",this.localFile="",Object(h.d)(this)}return Object(l.a)(t,[{key:"setUserName",value:function(t){this.username=t}},{key:"setLocalFile",value:function(t){this.localFile=t}},{key:"setSocket",value:function(t){this.socket=t}},{key:"setSessionId",value:function(t){this.sessionid=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"pushToUndo",value:function(t){this.undoList.push(t)}},{key:"pushToRedo",value:function(t){this.redoList.push(t)}},{key:"undo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.undoList.length>0){var i=this.undoList.pop();this.redoList.push(this.canvas.toDataURL());var n=new Image;n.src=i,n.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(n,0,0,t.canvas.width,t.canvas.height)}}else e.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"redo",value:function(){var t=this,e=this.canvas.getContext("2d");if(this.redoList.length>0){var i=this.redoList.pop();this.undoList.push(this.canvas.toDataURL());var n=new Image;n.src=i,n.onload=function(){e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(n,0,0,t.canvas.width,t.canvas.height)}}}}]),t}()),b=i(2),m=i(13),w=i(12),j=function(){function t(e,i,n){Object(r.a)(this,t),this.canvas=e,this.socket=i,this.id=n,this.ctx=e.getContext("2d"),this.destroyEvents()}return Object(l.a)(t,[{key:"fillColor",set:function(t){this.ctx.fillStyle=t}},{key:"strokeStyle",set:function(t){this.ctx.strokeStyle=t}},{key:"lineWidth",set:function(t){this.ctx.lineWidth=t}},{key:"destroyEvents",value:function(){this.canvas.onmousemove=null,this.canvas.onmouseup=null,this.canvas.onmousedown=null,this.canvas.onmouseleave=null}}]),t}(),y=function(t){Object(m.a)(i,t);var e=Object(w.a)(i);function i(t,n,a,s){var o;return Object(r.a)(this,i),(o=e.call(this,t,n,a)).finishDraw=function(){o.mouseDown=!1,o.socket.send(JSON.stringify({method:"draw",id:o.id,figure:{type:"finish"}}))},o.isEraser=s,o.canvas.onmousemove=o.mouseMoveHadler.bind(Object(b.a)(o)),o.canvas.onmouseup=o.finishDraw.bind(Object(b.a)(o)),o.canvas.onmousedown=o.mouseDownHadler.bind(Object(b.a)(o)),o.canvas.onmouseleave=o.finishDraw.bind(Object(b.a)(o)),o}return Object(l.a)(i,[{key:"mouseDownHadler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.ctx.moveTo(t.pageX-t.target.offsetLeft,t.pageY-t.target.offsetTop)}},{key:"mouseMoveHadler",value:function(t){this.mouseDown&&this.socket.send(JSON.stringify({method:"draw",id:this.id,figure:{type:"brush",x:t.pageX-t.target.offsetLeft,y:t.pageY-t.target.offsetTop,color:this.ctx.fillStyle,lineWidth:this.ctx.lineWidth,strokeStyle:this.ctx.strokeStyle,isEraser:this.isEraser}}))}}],[{key:"draw",value:function(t,e,i,n,a,s,o){var c=t.fillStyle,r=t.strokeStyle,l=t.lineWidth;o?(t.fillStyle="white",t.strokeStyle="white"):(t.fillStyle=n,t.strokeStyle=s),t.lineWidth=a,t.lineTo(e,i),t.stroke(),t.fillStyle=c,t.strokeStyle=r,t.lineWidth=l}}]),i}(j),k=function(t){Object(m.a)(i,t);var e=Object(w.a)(i);function i(t,n,a){var s;return Object(r.a)(this,i),(s=e.call(this,t,n,a)).finishDraw=function(){s.mouseDown=!1,s.drawing&&s.socket.send(JSON.stringify({method:"draw",id:s.id,figure:{type:"circle",x:s.startX,y:s.startY,radius:s.radius,color:s.ctx.fillStyle,lineWidth:s.ctx.lineWidth,strokeStyle:s.ctx.strokeStyle}})),s.drawing=!1},s.drawing=!1,s.canvas.onmousemove=s.mouseMoveHadler.bind(Object(b.a)(s)),s.canvas.onmouseup=s.finishDraw.bind(Object(b.a)(s)),s.canvas.onmousedown=s.mouseDownHadler.bind(Object(b.a)(s)),s.canvas.onmouseleave=s.finishDraw.bind(Object(b.a)(s)),s}return Object(l.a)(i,[{key:"mouseDownHadler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHadler",value:function(t){if(this.mouseDown){this.drawing=!0;var e=t.pageX-t.target.offsetLeft,i=t.pageY-t.target.offsetTop;this.radius=Math.sqrt(Math.pow(e-this.startX,2)+Math.pow(i-this.startY,2)),this.rerender(this.startX,this.startY,this.radius)}}},{key:"rerender",value:function(t,e,i){var n=this,a=new Image;a.src=this.saved,a.onload=function(){n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),n.ctx.drawImage(a,0,0,n.canvas.width,n.canvas.height),n.ctx.beginPath(),n.ctx.arc(t,e,i,0,2*Math.PI),n.ctx.fill(),n.ctx.stroke()}}}],[{key:"draw",value:function(t,e,i,n,a,s,o){var c=t.fillStyle,r=t.strokeStyle,l=t.lineWidth;t.fillStyle=a,t.strokeStyle=o,t.lineWidth=s,t.beginPath(),t.arc(e,i,n,0,2*Math.PI),t.fill(),t.stroke(),t.fillStyle=c,t.strokeStyle=r,t.lineWidth=l}}]),i}(j),x=function(t){Object(m.a)(i,t);var e=Object(w.a)(i);function i(t,n,a){var s;return Object(r.a)(this,i),(s=e.call(this,t,n,a)).finishDraw=function(){s.mouseDown=!1,s.drawing&&s.socket.send(JSON.stringify({method:"draw",id:s.id,figure:{type:"line",x:s.startX,y:s.startY,x2:s.currentX,y2:s.currentY,color:s.ctx.fillStyle,lineWidth:s.ctx.lineWidth,strokeStyle:s.ctx.strokeStyle}})),s.drawing=!1},s.drawing=!1,s.canvas.onmousemove=s.mouseMoveHadler.bind(Object(b.a)(s)),s.canvas.onmouseup=s.finishDraw.bind(Object(b.a)(s)),s.canvas.onmousedown=s.mouseDownHadler.bind(Object(b.a)(s)),s.canvas.onmouseleave=s.finishDraw.bind(Object(b.a)(s)),s}return Object(l.a)(i,[{key:"mouseDownHadler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHadler",value:function(t){this.mouseDown&&(this.drawing=!0,this.currentX=t.pageX-t.target.offsetLeft,this.currentY=t.pageY-t.target.offsetTop,this.rerender(this.startX,this.startY,this.currentX,this.currentY))}},{key:"rerender",value:function(t,e,i,n){var a=this,s=new Image;s.src=this.saved,s.onload=function(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.ctx.drawImage(s,0,0,a.canvas.width,a.canvas.height),a.ctx.beginPath(),a.ctx.moveTo(t,e),a.ctx.lineTo(i,n),a.ctx.stroke()}}}],[{key:"draw",value:function(t,e,i,n,a,s,o,c){var r=t.fillStyle,l=t.strokeStyle,h=t.lineWidth;t.fillStyle=s,t.strokeStyle=c,t.lineWidth=o,t.beginPath(),t.moveTo(e,i),t.lineTo(n,a),t.stroke(),t.fillStyle=r,t.strokeStyle=l,t.lineWidth=h}}]),i}(j),O=function(t){Object(m.a)(i,t);var e=Object(w.a)(i);function i(t,n,a){var s;return Object(r.a)(this,i),(s=e.call(this,t,n,a)).finishDraw=function(){s.mouseDown=!1,s.drawing&&s.socket.send(JSON.stringify({method:"draw",id:s.id,figure:{type:"rect",x:s.startX,y:s.startY,width:s.width,height:s.height,color:s.ctx.fillStyle,lineWidth:s.ctx.lineWidth,strokeStyle:s.ctx.strokeStyle}})),s.drawing=!1},s.drawing=!1,s.canvas.onmousemove=s.mouseMoveHadler.bind(Object(b.a)(s)),s.canvas.onmouseup=s.finishDraw.bind(Object(b.a)(s)),s.canvas.onmousedown=s.mouseDownHadler.bind(Object(b.a)(s)),s.canvas.onmouseleave=s.finishDraw.bind(Object(b.a)(s)),s}return Object(l.a)(i,[{key:"mouseDownHadler",value:function(t){this.mouseDown=!0,this.ctx.beginPath(),this.startX=t.pageX-t.target.offsetLeft,this.startY=t.pageY-t.target.offsetTop,this.saved=this.canvas.toDataURL()}},{key:"mouseMoveHadler",value:function(t){if(this.mouseDown){this.drawing=!0;var e=t.pageX-t.target.offsetLeft,i=t.pageY-t.target.offsetTop;this.width=e-this.startX,this.height=i-this.startY,this.rerender(this.startX,this.startY,this.width,this.height)}}},{key:"rerender",value:function(t,e,i,n){var a=this,s=new Image;s.src=this.saved,s.onload=function(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.ctx.drawImage(s,0,0,a.canvas.width,a.canvas.height),a.ctx.beginPath(),a.ctx.rect(t,e,i,n),a.ctx.fill(),a.ctx.stroke()}}}],[{key:"draw",value:function(t,e,i,n,a,s,o,c){var r=t.fillStyle,l=t.strokeStyle,h=t.lineWidth;t.fillStyle=s,t.strokeStyle=c,t.lineWidth=o,t.beginPath(),t.rect(e,i,n,a),t.fill(),t.stroke(),t.fillStyle=r,t.strokeStyle=l,t.lineWidth=h}}]),i}(j),p=function(){var t=Object(n.useState)(1),e=Object(v.a)(t,2),i=e[0],a=e[1],s=function(t,e){a(+t.target.parentNode.getAttribute("index"));var i=y,n=t.target.getAttribute("name");"Brush"===n?i=y:"Rect"===n?i=O:"Circle"===n?i=k:"Line"===n&&(i=x),u.setTool(new i(g.canvas,g.socket,g.sessionid,e))};return Object(d.jsxs)("div",{className:"toolbar",children:[Object(d.jsx)("button",{index:"1",className:"toolbar__btn ".concat(1===i?"active":""),children:Object(d.jsx)("i",{className:"material-icons",name:"Brush",onClick:function(t){return s(t)},children:"brush"})}),Object(d.jsx)("button",{index:"2",className:"toolbar__btn ".concat(2===i?"active":""),children:Object(d.jsx)("i",{className:"material-icons",name:"Rect",onClick:function(t){return s(t)},children:"check_box_outline_blank"})}),Object(d.jsx)("button",{index:"3",className:"toolbar__btn ".concat(3===i?"active":""),children:Object(d.jsx)("i",{className:"material-icons",name:"Circle",onClick:function(t){return s(t)},children:"panorama_fish_eye"})}),Object(d.jsx)("button",{index:"4",className:"toolbar__btn ".concat(4===i?"active":""),children:Object(d.jsx)("i",{className:"material-icons",name:"Brush",onClick:function(t){return s(t,!0)},children:"format_paint"})}),Object(d.jsx)("button",{index:"5",className:"toolbar__btn ".concat(5===i?"active":""),children:Object(d.jsx)("i",{className:"material-icons",name:"Line",onClick:function(t){return s(t)},children:"remove"})}),Object(d.jsx)("i",{className:"material-icons",style:{marginLeft:"10px"},children:"color_lens"}),Object(d.jsx)("input",{onChange:function(t){return function(t){u.setStrokeColor(t.target.value),u.setFillColor(t.target.value)}(t)},type:"color"}),Object(d.jsx)("button",{className:"toolbar__btn",onClick:function(){var t=document.createElement("input");t.type="file",t.accept="image/jpeg,image/png,image/bmp",t.onchange=function(t){var e=new FileReader;e.onloadend=function(){g.setLocalFile(e.result)},e.readAsDataURL(t.target.files[0])},t.click()},style:{marginLeft:"auto"},children:Object(d.jsx)("i",{className:"material-icons",children:"folder_open"})}),Object(d.jsx)("button",{className:"toolbar__btn",onClick:function(){var t=document.createElement("a");t.href=g.canvas.toDataURL(),t.download=g.sessionid+".jpg",t.click()},children:Object(d.jsx)("i",{className:"material-icons",children:"save"})})]})},S=i(3),D=i(19),L=i.n(D),N="https://kalina-paint-server.herokuapp.com",C=(i(59),Object(c.a)((function(){var t=Object(n.useRef)(null),e=Object(n.useRef)(null),i=Object(n.useRef)(null),a=Object(n.useState)({width:520,height:420}),s=Object(v.a)(a,2),o=s[0],c=s[1],r=Object(S.g)(),l=function(e){var i=t.current,n=i.getContext("2d"),a=new Image;a.src=e,a.crossOrigin="anonymous",a.onload=function(){i.width=a.width,i.height=a.height,c({width:a.width+20,height:a.height+20}),n.clearRect(0,0,i.width,i.height),n.drawImage(a,0,0,i.width,i.height),m()}};Object(n.useEffect)((function(){g.setCanvas(t.current),L.a.get("".concat(N,"/image?id=").concat(r.id)).then((function(t){return l(t.data)})).catch((function(t){return h()})),e.current.onmousedown=function(){var t=0,i=!0;new ResizeObserver((function(){return++t})).observe(e.current),window.onmouseup=function(){if(i=!1,t>1){var n=e.current.style,a=n.width,s=n.height;g.socket.send(JSON.stringify({method:"resize",id:g.sessionid,size:{width:a,height:s}}))}},i||(window.onmouseup=null)}}),[]);var h=function(){var e=t.current.getContext("2d"),i=e.fillStyle;e.fillStyle="white",e.fillRect(0,0,t.current.width,t.current.height),e.fillStyle=i};Object(n.useEffect)((function(){var e=new WebSocket(N.replace(/^http/,"ws"));g.setSocket(e),g.setSessionId(r.id),u.setTool(new y(t.current,e,r.id)),e.onopen=function(){console.log("connected"),e.send(JSON.stringify({id:r.id,username:"anonymous",method:"connection"}))},e.onmessage=function(t){var e=JSON.parse(t.data);switch(e.method){case"connection":console.log(e.username+" connected");break;case"draw":b(e);break;case"resize":f(e.size);break;case"local_file":l(e.file)}}}),[g.username]),Object(n.useEffect)((function(){g.localFile&&g.socket.send(JSON.stringify({method:"local_file",id:g.sessionid,file:g.localFile}))}),[g.localFile]);var f=function(i){var n=t.current;e.current.style.width=i.width,e.current.style.height=i.height,n.width=+i.width.replace("px","")-20,n.height=+i.height.replace("px","")-20,L.a.get("".concat(N,"/image?id=").concat(r.id)).then((function(t){var e=new Image;e.crossOrigin="anonymous",e.src=t.data;var i=n.getContext("2d");e.onload=function(){var t=Math.round((n.width-e.width)/2),a=Math.round((n.height-e.height)/2);i.clearRect(0,0,n.width,n.height),h(),i.drawImage(e,t,a,e.width,e.height),m()}}))},b=function(e){var i=e.figure,n=i.type,a=i.x,s=i.y,o=i.x2,c=i.y2,r=i.width,l=i.height,h=i.radius,u=i.color,d=i.lineWidth,f=i.strokeStyle,v=i.isEraser,g=t.current.getContext("2d");switch(n){case"brush":y.draw(g,a,s,u,d,f,v);break;case"line":x.draw(g,a,s,o,c,u,d,f);break;case"rect":O.draw(g,a,s,r,l,u,d,f);break;case"circle":k.draw(g,a,s,h,u,d,f);break;case"finish":g.beginPath()}},m=function(){L.a.post("".concat(N,"/image?id=").concat(r.id),{image:t.current.toDataURL()})};return Object(d.jsx)("div",{className:"canvas",ref:i,children:Object(d.jsx)("div",{ref:e,className:"resize",style:{width:o.width,height:o.height},children:Object(d.jsx)("canvas",{ref:t,onMouseDown:function(){g.pushToUndo(t.current.toDataURL())},onMouseUp:function(){return m()},width:o.width-20,height:o.height-20})})})}))),W=i(22);i(67);var R=function(){return Object(d.jsx)(W.a,{children:Object(d.jsx)("div",{className:"app",children:Object(d.jsxs)(S.d,{children:[Object(d.jsxs)(S.b,{path:"/:id",children:[Object(d.jsx)(p,{}),Object(d.jsx)(f,{}),Object(d.jsx)(C,{})]}),Object(d.jsx)(S.a,{to:"f".concat((+new Date).toString(16))})]})})})};o.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(R,{})}),document.getElementById("root"))}},[[68,1,2]]]);
//# sourceMappingURL=main.9704f859.chunk.js.map